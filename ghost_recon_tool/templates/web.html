{% if page != "results_fragment" %}<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ghost Recon Tool{% if page == "results" and result %} â€” {{ result.domain }}{% endif %}</title>
<link rel="icon" type="image/png" href="/logo.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg:#070b14;--bg2:#040710;--surface:#0d1526;--surface2:#111d35;
  --border:#1e2d4a;--border2:#162240;
  --accent:#3b82f6;--accent2:#2563eb;--cyan:#06b6d4;--green:#10b981;
  --yellow:#f59e0b;--orange:#f97316;--red:#ef4444;--purple:#8b5cf6;--pink:#ec4899;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#475569;
  --mono:'JetBrains Mono',monospace;--sans:'Inter',system-ui,sans-serif;
  --r1:6px;--r2:10px;--r3:16px;
  --shadow:0 4px 24px rgba(0,0,0,.5);--glow:0 0 40px rgba(59,130,246,.15);
  --sidebar-w:224px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100%;background:var(--bg);color:var(--text);font-family:var(--sans);font-size:14px;line-height:1.6}
a{color:var(--accent);text-decoration:none}
a:hover{color:var(--cyan)}
code,pre,kbd{font-family:var(--mono);font-size:12px}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--border)}

/* â”€â”€ NAV â”€â”€ */
.nav{
  position:sticky;top:0;z-index:600;height:52px;
  background:rgba(7,11,20,.9);backdrop-filter:blur(16px);
  border-bottom:1px solid var(--border2);
  display:flex;align-items:center;padding:0 20px;gap:16px;
}
.nav-logo{display:flex;align-items:center;gap:10px;flex-shrink:0;cursor:pointer}
.nav-logo img{width:32px;height:32px;border-radius:7px;object-fit:contain}
.nav-brand{line-height:1.2}
.nav-brand-name{font-weight:800;font-size:14px;letter-spacing:.3px;color:var(--text)}
.nav-brand-sub{font-size:10px;color:var(--text2);letter-spacing:.4px}
.nav-links{display:flex;gap:2px;margin-left:auto}
.nav-link{
  padding:5px 12px;border-radius:var(--r1);color:var(--text2);font-size:13px;
  font-weight:500;transition:all .15s;cursor:pointer;border:none;background:none;
}
.nav-link:hover{color:var(--text);background:rgba(255,255,255,.05)}
.nav-link.active{color:var(--accent);background:rgba(59,130,246,.1)}
.nav-scan-info{
  display:flex;align-items:center;gap:8px;padding:4px 12px;
  border-radius:20px;background:var(--surface);border:1px solid var(--border);
  font-size:11px;color:var(--text2);
}
.pulse{width:6px;height:6px;border-radius:50%;background:var(--green);
  box-shadow:0 0 6px var(--green);animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* â”€â”€ HOME â”€â”€ */
.home-wrap{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:calc(100vh - 52px - 48px);padding:40px 20px;
}
.home-logo{width:110px;height:110px;border-radius:20px;object-fit:contain;
  filter:drop-shadow(0 0 32px rgba(59,130,246,.35));margin-bottom:24px}
.home-title{
  font-size:32px;font-weight:800;letter-spacing:-1px;
  background:linear-gradient(135deg,#e2e8f0 30%,var(--cyan));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  margin-bottom:8px;text-align:center;
}
.home-tagline{color:var(--text2);font-size:14px;letter-spacing:.5px;margin-bottom:36px;text-align:center}
.scan-box{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--r3);padding:28px 32px;width:100%;max-width:540px;
  box-shadow:var(--shadow),var(--glow);
}
.scan-box-title{font-size:13px;font-weight:600;color:var(--text2);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:16px}
.input-row{display:flex;gap:8px;margin-bottom:12px}
.domain-input{
  flex:1;background:var(--bg);border:1px solid var(--border);border-radius:var(--r2);
  padding:10px 14px;color:var(--text);font-size:14px;font-family:var(--mono);
  outline:none;transition:border-color .2s;
}
.domain-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(59,130,246,.1)}
.domain-input::placeholder{color:var(--text3)}
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:10px 18px;border-radius:var(--r2);font-size:13px;font-weight:600;
  cursor:pointer;border:none;transition:all .15s;white-space:nowrap;
}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:var(--accent2);transform:translateY(-1px)}
.btn-primary:active{transform:translateY(0)}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border)}
.btn-ghost:hover{color:var(--text);border-color:var(--text3);background:var(--surface2)}
.btn-sm{padding:6px 12px;font-size:12px}
.btn-danger{background:rgba(239,68,68,.15);color:var(--red);border:1px solid rgba(239,68,68,.3)}
.btn-danger:hover{background:rgba(239,68,68,.25)}
.mode-pills{display:flex;gap:6px;flex-wrap:wrap}
.mode-pill{
  padding:5px 14px;border-radius:20px;font-size:12px;font-weight:600;
  cursor:pointer;border:1px solid var(--border);color:var(--text2);
  background:var(--surface2);transition:all .15s;
}
.mode-pill:hover{border-color:var(--accent);color:var(--accent)}
.mode-pill.selected{background:rgba(59,130,246,.15);border-color:var(--accent);color:var(--accent)}
.scan-hint{font-size:11px;color:var(--text3);margin-top:14px;line-height:1.6}

/* â”€â”€ HISTORY â”€â”€ */
.page-wrap{max-width:1100px;margin:0 auto;padding:28px 20px}
.page-title{font-size:20px;font-weight:700;margin-bottom:20px;color:var(--text)}
.history-table{width:100%;border-collapse:collapse}
.history-table th{
  text-align:left;padding:10px 14px;font-size:11px;text-transform:uppercase;
  letter-spacing:.8px;color:var(--text3);border-bottom:1px solid var(--border2);
}
.history-table td{padding:12px 14px;border-bottom:1px solid rgba(30,45,74,.5);vertical-align:middle}
.history-table tr:hover td{background:var(--surface2)}
.history-table a{font-family:var(--mono);font-size:13px;font-weight:600}

/* â”€â”€ RESULTS LAYOUT â”€â”€ */
.results-layout{display:flex;min-height:calc(100vh - 52px)}
.sidebar{
  width:var(--sidebar-w);flex-shrink:0;
  position:sticky;top:52px;height:calc(100vh - 52px);
  overflow-y:auto;overflow-x:hidden;
  background:var(--bg2);border-right:1px solid var(--border2);
  padding:12px 8px;
}
.sidebar::-webkit-scrollbar{width:3px}
.sidebar-section-label{
  font-size:10px;text-transform:uppercase;letter-spacing:1px;
  color:var(--text3);padding:12px 8px 6px;font-weight:600;
}
.sidebar-link{
  display:flex;align-items:center;gap:8px;padding:7px 10px;
  border-radius:var(--r1);color:var(--text2);font-size:12.5px;font-weight:500;
  transition:all .15s;cursor:pointer;text-decoration:none;
}
.sidebar-link:hover{color:var(--text);background:var(--surface)}
.sidebar-link.active{color:var(--accent);background:rgba(59,130,246,.1)}
.sidebar-link .s-icon{font-size:13px;flex-shrink:0;width:16px;text-align:center}
.sidebar-link .s-label{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.sidebar-badge{
  flex-shrink:0;font-size:10px;font-weight:700;padding:1px 6px;
  border-radius:10px;background:var(--surface2);color:var(--text3);min-width:18px;text-align:center;
}
.sidebar-link.active .sidebar-badge{background:rgba(59,130,246,.2);color:var(--accent)}
.sidebar-divider{height:1px;background:var(--border2);margin:8px 0}
.results-main{flex:1;min-width:0;padding:20px 24px;overflow-x:hidden}

/* â”€â”€ RESULTS SUMMARY BAR â”€â”€ */
.summary-bar{
  background:var(--surface);border:1px solid var(--border2);
  border-radius:var(--r3);padding:20px 24px;margin-bottom:20px;
}
.summary-top{display:flex;align-items:center;gap:16px;flex-wrap:wrap;margin-bottom:16px}
.summary-domain{
  font-size:20px;font-weight:800;font-family:var(--mono);
  color:var(--text);letter-spacing:-0.5px;
}
.risk-badge{
  display:inline-flex;align-items:center;gap:5px;
  padding:4px 14px;border-radius:20px;font-size:12px;font-weight:700;letter-spacing:.5px;
}
.risk-CRITICAL{background:rgba(239,68,68,.2);color:var(--red);border:1px solid rgba(239,68,68,.4)}
.risk-HIGH{background:rgba(249,115,22,.2);color:var(--orange);border:1px solid rgba(249,115,22,.4)}
.risk-MEDIUM{background:rgba(245,158,11,.2);color:var(--yellow);border:1px solid rgba(245,158,11,.4)}
.risk-LOW{background:rgba(16,185,129,.2);color:var(--green);border:1px solid rgba(16,185,129,.4)}
.summary-actions{display:flex;gap:8px;margin-left:auto;flex-wrap:wrap}
.score-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
@media(max-width:900px){.score-grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:600px){.score-grid{grid-template-columns:repeat(2,1fr)}}
.score-card{
  background:var(--bg);border:1px solid var(--border2);border-radius:var(--r2);
  padding:12px 14px;text-align:center;
}
.score-card-label{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;margin-bottom:6px;font-weight:600}
.score-card-value{font-size:26px;font-weight:800;line-height:1;margin-bottom:6px;font-family:var(--mono)}
.score-bar-wrap{height:4px;background:var(--border2);border-radius:2px;overflow:hidden}
.score-bar-fill{height:100%;border-radius:2px;transition:width 1s ease}
.score-card-overall{position:relative}
.score-gauge-wrap{display:flex;flex-direction:column;align-items:center;gap:4px}
.summary-meta{
  display:flex;gap:16px;flex-wrap:wrap;margin-top:12px;padding-top:12px;
  border-top:1px solid var(--border2);font-size:12px;color:var(--text2);
}
.meta-item{display:flex;align-items:center;gap:5px}
.meta-item strong{color:var(--text)}

/* â”€â”€ QUICK STATS BAR â”€â”€ */
.quick-stats{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px}
.stat-chip{
  display:flex;align-items:center;gap:6px;padding:6px 12px;
  background:var(--surface);border:1px solid var(--border2);border-radius:20px;
  font-size:12px;color:var(--text2);
}
.stat-chip strong{color:var(--text);font-weight:700}
.stat-chip .chip-icon{font-size:13px}

/* â”€â”€ SECTION CARDS (COLLAPSIBLE) â”€â”€ */
.section-card{
  background:var(--surface);border:1px solid var(--border2);
  border-radius:var(--r2);margin-bottom:12px;overflow:hidden;
}
.section-header{
  display:flex;align-items:center;gap:10px;padding:14px 18px;
  cursor:pointer;user-select:none;transition:background .15s;
  border-bottom:1px solid transparent;
}
.section-header:hover{background:var(--surface2)}
.section-header.open{border-bottom-color:var(--border2)}
.section-title{font-size:14px;font-weight:700;color:var(--text);letter-spacing:.2px}
.section-count{
  padding:2px 8px;border-radius:12px;font-size:11px;font-weight:700;
  background:var(--surface2);color:var(--text2);
}
.section-chevron{
  margin-left:auto;width:16px;height:16px;flex-shrink:0;
  transition:transform .3s ease;color:var(--text3);
}
.section-chevron.rotated{transform:rotate(-90deg)}
.section-body{overflow:hidden;transition:max-height .35s ease}
.section-inner{padding:16px 18px}

/* â”€â”€ TOOLBAR â”€â”€ */
.section-toolbar{
  display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:14px;
}
.expand-all-bar{
  display:flex;gap:8px;align-items:center;margin-bottom:16px;
}

/* â”€â”€ TABLES â”€â”€ */
.data-table{width:100%;border-collapse:collapse;font-size:12.5px}
.data-table th{
  text-align:left;padding:8px 12px;font-size:10.5px;text-transform:uppercase;
  letter-spacing:.7px;color:var(--text3);border-bottom:1px solid var(--border2);font-weight:600;
}
.data-table td{padding:9px 12px;border-bottom:1px solid rgba(30,45,74,.4);vertical-align:middle}
.data-table tbody tr:hover td{background:rgba(255,255,255,.02)}
.data-table .mono{font-family:var(--mono);font-size:12px}
.table-wrap{overflow-x:auto}

/* â”€â”€ BADGES & CHIPS â”€â”€ */
.badge{
  display:inline-block;padding:2px 7px;border-radius:4px;
  font-size:11px;font-weight:600;font-family:var(--mono);
}
.badge-green{background:rgba(16,185,129,.15);color:#10b981;border:1px solid rgba(16,185,129,.3)}
.badge-blue{background:rgba(59,130,246,.15);color:#3b82f6;border:1px solid rgba(59,130,246,.3)}
.badge-yellow{background:rgba(245,158,11,.15);color:#f59e0b;border:1px solid rgba(245,158,11,.3)}
.badge-orange{background:rgba(249,115,22,.15);color:#f97316;border:1px solid rgba(249,115,22,.3)}
.badge-red{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.3)}
.badge-purple{background:rgba(139,92,246,.15);color:#8b5cf6;border:1px solid rgba(139,92,246,.3)}
.badge-gray{background:rgba(148,163,184,.1);color:#94a3b8;border:1px solid rgba(148,163,184,.2)}
.badge-cyan{background:rgba(6,182,212,.15);color:#06b6d4;border:1px solid rgba(6,182,212,.3)}

/* Port badges */
.port-b{display:inline-block;padding:2px 6px;border-radius:3px;font-size:10.5px;font-family:var(--mono);font-weight:600;margin:1px}
.port-https{background:rgba(16,185,129,.15);color:#10b981;border:1px solid rgba(16,185,129,.3)}
.port-http{background:rgba(148,163,184,.1);color:#94a3b8;border:1px solid rgba(148,163,184,.2)}
.port-ssh{background:rgba(245,158,11,.15);color:#f59e0b;border:1px solid rgba(245,158,11,.3)}
.port-danger{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.3)}
.port-other{background:rgba(59,130,246,.1);color:#3b82f6;border:1px solid rgba(59,130,246,.2)}

/* Severity */
.sev{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:4px;font-size:11px;font-weight:700;letter-spacing:.4px}
.sev-CRITICAL{background:rgba(239,68,68,.2);color:#ef4444;border:1px solid rgba(239,68,68,.4)}
.sev-HIGH{background:rgba(249,115,22,.2);color:#f97316;border:1px solid rgba(249,115,22,.4)}
.sev-MEDIUM{background:rgba(245,158,11,.2);color:#f59e0b;border:1px solid rgba(245,158,11,.4)}
.sev-LOW{background:rgba(59,130,246,.15);color:#3b82f6;border:1px solid rgba(59,130,246,.3)}
.sev-INFO{background:rgba(148,163,184,.1);color:#94a3b8;border:1px solid rgba(148,163,184,.2)}

/* DNS type badges */
.dns-A{background:rgba(59,130,246,.15);color:#3b82f6;border:1px solid rgba(59,130,246,.3)}
.dns-AAAA{background:rgba(6,182,212,.15);color:#06b6d4;border:1px solid rgba(6,182,212,.3)}
.dns-MX{background:rgba(139,92,246,.15);color:#8b5cf6;border:1px solid rgba(139,92,246,.3)}
.dns-TXT{background:rgba(249,115,22,.15);color:#f97316;border:1px solid rgba(249,115,22,.3)}
.dns-NS{background:rgba(6,182,212,.15);color:#06b6d4;border:1px solid rgba(6,182,212,.3)}
.dns-CNAME{background:rgba(245,158,11,.15);color:#f59e0b;border:1px solid rgba(245,158,11,.3)}
.dns-SOA{background:rgba(16,185,129,.15);color:#10b981;border:1px solid rgba(16,185,129,.3)}
.dns-CAA{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.3)}
.dns-DNSKEY{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.3)}
.dns-SRV{background:rgba(236,72,153,.15);color:#ec4899;border:1px solid rgba(236,72,153,.3)}

/* Takeover status */
.tak-VULNERABLE{background:rgba(239,68,68,.2);color:#ef4444;border:1px solid rgba(239,68,68,.4)}
.tak-LIKELY_VULNERABLE{background:rgba(249,115,22,.2);color:#f97316;border:1px solid rgba(249,115,22,.4)}
.tak-INVESTIGATE{background:rgba(245,158,11,.2);color:#f59e0b;border:1px solid rgba(245,158,11,.4)}

/* â”€â”€ VULNERABILITY CARDS â”€â”€ */
.vuln-filter-bar{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.vfilt{
  display:flex;align-items:center;gap:5px;padding:5px 12px;
  border-radius:20px;font-size:12px;font-weight:600;cursor:pointer;
  border:1px solid var(--border);color:var(--text2);background:var(--surface2);
  transition:all .15s;
}
.vfilt:hover{border-color:var(--text3);color:var(--text)}
.vfilt.active{background:rgba(59,130,246,.15);border-color:var(--accent);color:var(--accent)}
.vfilt.crit.active{background:rgba(239,68,68,.15);border-color:var(--red);color:var(--red)}
.vfilt.high.active{background:rgba(249,115,22,.15);border-color:var(--orange);color:var(--orange)}
.vfilt.med.active{background:rgba(245,158,11,.15);border-color:var(--yellow);color:var(--yellow)}
.vfilt.low.active{background:rgba(59,130,246,.15);border-color:var(--accent);color:var(--accent)}
.vfilt-count{font-size:10px;font-weight:700;padding:1px 5px;border-radius:8px;background:var(--bg)}

.vuln-card{
  border:1px solid var(--border2);border-radius:var(--r2);margin-bottom:10px;
  overflow:hidden;transition:border-color .2s;
}
.vuln-card:hover{border-color:var(--border)}
.vuln-card[data-sev="CRITICAL"]{border-left:3px solid var(--red)}
.vuln-card[data-sev="HIGH"]{border-left:3px solid var(--orange)}
.vuln-card[data-sev="MEDIUM"]{border-left:3px solid var(--yellow)}
.vuln-card[data-sev="LOW"]{border-left:3px solid var(--accent)}
.vuln-card[data-sev="INFO"]{border-left:3px solid var(--text3)}
.vuln-header{display:flex;align-items:flex-start;gap:10px;padding:12px 14px 8px;cursor:pointer}
.vuln-title{font-size:13px;font-weight:700;flex:1;line-height:1.4}
.vuln-source{font-size:10px;color:var(--text3);font-family:var(--mono);flex-shrink:0}
.vuln-body{padding:0 14px 14px}
.vuln-meta{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px;font-size:11.5px;color:var(--text2)}
.vuln-meta span{display:flex;align-items:center;gap:4px}
.vuln-meta strong{color:var(--text)}
.vuln-desc{font-size:12.5px;color:var(--text2);line-height:1.6;margin-bottom:8px}
.vuln-remediation{
  font-size:12px;color:var(--green);padding:8px 12px;
  background:rgba(16,185,129,.05);border:1px solid rgba(16,185,129,.15);border-radius:var(--r1);
  margin-bottom:8px;
}
.vuln-remediation::before{content:"ğŸ”§ ";font-size:11px}
.vuln-refs{display:flex;gap:6px;flex-wrap:wrap}
.vuln-refs a{font-size:11px;color:var(--accent);font-family:var(--mono)}
.hidden{display:none!important}

/* â”€â”€ SECURITY HEADERS DISPLAY â”€â”€ */
.grade-display{
  display:inline-flex;align-items:center;justify-content:center;
  width:60px;height:60px;border-radius:var(--r2);
  font-size:28px;font-weight:900;font-family:var(--mono);
}
.grade-A{background:rgba(16,185,129,.2);color:#10b981;border:2px solid rgba(16,185,129,.4)}
.grade-B{background:rgba(245,158,11,.2);color:#f59e0b;border:2px solid rgba(245,158,11,.4)}
.grade-C{background:rgba(249,115,22,.2);color:#f97316;border:2px solid rgba(249,115,22,.4)}
.grade-D,.grade-F{background:rgba(239,68,68,.2);color:#ef4444;border:2px solid rgba(239,68,68,.4)}
.header-check{display:flex;gap:6px;align-items:center;padding:6px 0;font-size:12.5px;border-bottom:1px solid var(--border2)}
.header-check:last-child{border-bottom:none}
.check-name{flex:1;font-weight:600}
.check-val{font-family:var(--mono);font-size:11px;color:var(--text2);max-width:300px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.check-ok{color:var(--green)}
.check-miss{color:var(--red)}

/* â”€â”€ WHOIS â”€â”€ */
.kv-grid{display:grid;grid-template-columns:160px 1fr;gap:0}
.kv-row{display:contents}
.kv-key{padding:7px 12px 7px 0;font-size:12px;color:var(--text3);font-weight:600;border-bottom:1px solid var(--border2)}
.kv-val{padding:7px 0;font-size:12.5px;color:var(--text);border-bottom:1px solid var(--border2);font-family:var(--mono);word-break:break-all}

/* â”€â”€ DROPDOWNS â”€â”€ */
.dropdown{position:relative;display:inline-block}
.dropdown-menu{
  position:absolute;top:calc(100% + 4px);right:0;z-index:400;
  background:var(--surface2);border:1px solid var(--border);border-radius:var(--r2);
  min-width:160px;box-shadow:var(--shadow);display:none;overflow:hidden;
}
.dropdown-menu.open{display:block}
.dropdown-item{
  display:block;padding:9px 14px;font-size:13px;color:var(--text2);
  cursor:pointer;transition:all .1s;text-decoration:none;
}
.dropdown-item:hover{background:var(--surface);color:var(--text)}

/* â”€â”€ SCAN OVERLAY â”€â”€ */
#scan-overlay{
  position:fixed;inset:0;z-index:900;background:rgba(4,7,16,.95);
  backdrop-filter:blur(8px);display:none;
  flex-direction:column;align-items:center;justify-content:center;
  padding:40px 20px;
}
#scan-overlay.visible{display:flex}
.overlay-logo{width:64px;height:64px;border-radius:12px;object-fit:contain;
  margin-bottom:16px;filter:drop-shadow(0 0 24px rgba(59,130,246,.5))}
.overlay-title{font-size:22px;font-weight:800;margin-bottom:4px;text-align:center}
.overlay-domain{font-size:14px;color:var(--cyan);font-family:var(--mono);margin-bottom:28px;text-align:center}
.overlay-progress{
  width:100%;max-width:480px;background:var(--surface);
  border:1px solid var(--border);border-radius:var(--r3);padding:20px;max-height:380px;overflow-y:auto;
}
.phase-row{
  display:flex;align-items:center;gap:10px;padding:6px 8px;
  border-radius:var(--r1);transition:background .2s;font-size:13px;
}
.phase-row:hover{background:var(--surface2)}
.phase-icon{width:18px;text-align:center;font-size:13px;flex-shrink:0}
.phase-name{flex:1;font-weight:500}
.phase-cnt{font-size:11px;color:var(--text2);font-family:var(--mono)}
.overlay-status{
  margin-top:20px;font-size:13px;color:var(--text2);text-align:center;
}
.spinner{
  display:inline-block;width:14px;height:14px;
  border:2px solid var(--border);border-top-color:var(--accent);
  border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:6px;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ TOAST â”€â”€ */
#toast{
  position:fixed;bottom:24px;right:24px;z-index:9999;
  background:var(--surface2);border:1px solid var(--border);border-radius:var(--r2);
  padding:10px 16px;font-size:13px;color:var(--text);box-shadow:var(--shadow);
  transform:translateY(80px);opacity:0;transition:all .25s;pointer-events:none;
}
#toast.show{transform:translateY(0);opacity:1}

/* â”€â”€ FOOTER â”€â”€ */
.footer{
  border-top:1px solid var(--border2);padding:16px 24px;text-align:center;
  font-size:11.5px;color:var(--text3);letter-spacing:.3px;
}
.footer a{color:var(--text3)}
.footer a:hover{color:var(--text2)}

/* â”€â”€ EMPTY STATES â”€â”€ */
.empty-state{
  padding:32px;text-align:center;color:var(--text3);
  font-size:13px;
}
.empty-state .ei{font-size:32px;margin-bottom:8px}

/* â”€â”€ INFO GRID â”€â”€ */
.info-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
.info-chip{
  background:var(--bg);border:1px solid var(--border2);border-radius:var(--r1);
  padding:10px 14px;
}
.info-chip-label{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;margin-bottom:4px}
.info-chip-val{font-size:13px;font-weight:600;font-family:var(--mono);color:var(--text);word-break:break-all}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:768px){
  .results-layout{flex-direction:column}
  .sidebar{width:100%;height:auto;position:static;display:flex;flex-wrap:wrap;gap:4px;padding:8px}
  .sidebar-link{font-size:11px;padding:4px 8px}
  .sidebar-badge{display:none}
  .summary-top{flex-direction:column;align-items:flex-start}
  .summary-actions{margin-left:0}
  .score-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="nav">
  <a class="nav-logo" href="/">
    <img src="/logo.png" alt="Ghost Recon Tool">
    <div class="nav-brand">
      <div class="nav-brand-name">Ghost Recon Tool</div>
      <div class="nav-brand-sub">by mnt0x Â· v2.0</div>
    </div>
  </a>
  <div class="nav-links">
    <a class="nav-link {% if page == 'home' %}active{% endif %}" href="/">Home</a>
    <a class="nav-link {% if page == 'history' %}active{% endif %}" href="/history">History</a>
  </div>
  <div id="nav-scan-status" style="display:none" class="nav-scan-info">
    <span class="pulse" id="nav-dot"></span>
    <span id="nav-status-text" style="font-size:12px">Scanningâ€¦</span>
  </div>
</nav>

{% endif %}{# end !results_fragment #}

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% if page == "home" %}
<div class="home-wrap" id="home-view">
  <img src="/logo.png" alt="Ghost Recon Tool" class="home-logo">
  <h1 class="home-title">Ghost Recon Tool</h1>
  <p class="home-tagline">Passive Domain Intelligence &middot; by mnt0x</p>

  <div class="scan-box">
    <div class="scan-box-title">New Recon Scan</div>
    <div class="input-row">
      <input id="domain-input" class="domain-input" type="text"
             placeholder="example.com" autocomplete="off" spellcheck="false">
      <button class="btn btn-primary" id="scan-btn" onclick="startScan()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Scan
      </button>
    </div>
    <div style="margin-bottom:10px;font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.8px">Scan Mode</div>
    <div class="mode-pills">
      <div class="mode-pill" data-mode="fast" onclick="selectMode(this)">âš¡ Fast</div>
      <div class="mode-pill selected" data-mode="balanced" onclick="selectMode(this)">âš–ï¸ Balanced</div>
      <div class="mode-pill" data-mode="deep" onclick="selectMode(this)">ğŸ”¬ Deep</div>
      <div class="mode-pill" data-mode="turbo" onclick="selectMode(this)">ğŸš€ Turbo</div>
    </div>
    <div class="scan-hint">
      Passive reconnaissance only â€” no active probing of the target.<br>
      Results are saved and accessible from History.
    </div>
  </div>

  {% if history %}
  <div style="width:100%;max-width:700px;margin-top:32px">
    <div style="font-size:12px;color:var(--text3);text-transform:uppercase;letter-spacing:1px;font-weight:600;margin-bottom:12px">Recent Scans</div>
    <div style="display:flex;flex-direction:column;gap:6px">
      {% for h in history[:5] %}
      <a href="/results/{{ h.scan_id }}" style="display:flex;align-items:center;gap:12px;padding:10px 16px;background:var(--surface);border:1px solid var(--border2);border-radius:var(--r2);color:var(--text);transition:border-color .15s" onmouseover="this.style.borderColor='var(--border)'" onmouseout="this.style.borderColor='var(--border2)'">
        <span style="font-family:var(--mono);font-size:13px;font-weight:700;flex:1">{{ h.domain }}</span>
        <span class="risk-badge risk-{{ h.risk_level }}">{{ h.risk_level }}</span>
        <span style="font-size:11px;color:var(--text3)">{{ h.scan_date[:10] if h.scan_date else '' }}</span>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<!-- Scan Overlay -->
<div id="scan-overlay">
  <img src="/logo.png" class="overlay-logo" alt="">
  <div class="overlay-title">Scanning Target</div>
  <div class="overlay-domain" id="overlay-domain"></div>
  <div class="overlay-progress">
    <div id="phase-list"></div>
  </div>
  <div class="overlay-status" id="overlay-status">
    <span class="spinner"></span> Initializing modulesâ€¦
  </div>
</div>

<!-- Results Mount (fragment injected here after scan) -->
<div id="results-mount" style="display:none"></div>

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HISTORY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% elif page == "history" %}
<div class="page-wrap">
  <div class="page-title">Scan History</div>
  {% if history %}
  <div class="table-wrap">
    <table class="history-table">
      <thead>
        <tr>
          <th>Domain</th><th>Date</th><th>Mode</th><th>Risk</th>
          <th>Subdomains</th><th>Emails</th><th>Duration</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for h in history %}
        <tr>
          <td><a href="/results/{{ h.scan_id }}" class="mono">{{ h.domain }}</a></td>
          <td style="color:var(--text2);font-size:12px">{{ h.scan_date[:19] if h.scan_date else 'â€”' }}</td>
          <td><span class="badge badge-blue">{{ h.mode }}</span></td>
          <td><span class="risk-badge risk-{{ h.risk_level }}">{{ h.risk_level }} {{ h.overall_score }}</span></td>
          <td style="font-family:var(--mono);color:var(--text2)">{{ h.subdomains }}</td>
          <td style="font-family:var(--mono);color:var(--text2)">{{ h.emails }}</td>
          <td style="color:var(--text3);font-size:12px">{{ h.duration }}s</td>
          <td><a href="/results/{{ h.scan_id }}" class="btn btn-ghost btn-sm">View</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state"><div class="ei">ğŸ“‚</div>No scans yet. <a href="/">Run your first scan</a>.</div>
  {% endif %}
</div>

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESULTS (full + fragment) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% elif page in ("results", "results_fragment") %}
{% set r = result %}
{% set scores = r.scores if r.scores else {} %}
{% set vulns = r.vulnerabilities if r.vulnerabilities else [] %}
{% set subdomains = r.subdomains if r.subdomains else [] %}
{% set emails = r.emails if r.emails else [] %}
{% set dns_records = r.dns_records if r.dns_records else [] %}
{% set ip_records = r.ip_records if r.ip_records else [] %}
{% set ssl_info = r.ssl_info if r.ssl_info else [] %}
{% set takeover_records = r.takeover_records if r.takeover_records else [] %}
{% set breach_records = r.breach_records if r.breach_records else [] %}
{% set technologies = r.technologies if r.technologies else [] %}
{% set cloud_assets = r.cloud_assets if r.cloud_assets else [] %}
{% set typosquats = r.typosquats if r.typosquats else [] %}
{% set sec_headers = r.security_headers if r.security_headers else {} %}
{% set social = r.social_footprint if r.social_footprint else {} %}
{% set wayback = r.wayback_urls if r.wayback_urls else {} %}
{% set asn = r.asn_intelligence if r.asn_intelligence else {} %}
{% set whois = r.whois_data if r.whois_data else {} %}

{% set ns = namespace(crit=0,high=0,med=0,low=0) %}
{% for v in vulns %}
  {% if v.severity == "CRITICAL" %}{% set ns.crit = ns.crit + 1 %}
  {% elif v.severity == "HIGH" %}{% set ns.high = ns.high + 1 %}
  {% elif v.severity == "MEDIUM" %}{% set ns.med = ns.med + 1 %}
  {% elif v.severity == "LOW" %}{% set ns.low = ns.low + 1 %}{% endif %}
{% endfor %}

<div id="results-layout" class="results-layout">

  <!-- â•â•â• SIDEBAR â•â•â• -->
  <aside class="sidebar" id="results-sidebar">
    <div class="sidebar-section-label">Navigation</div>

    <a class="sidebar-link" href="#sec-vulnerabilities" onclick="scrollTo('sec-vulnerabilities')">
      <span class="s-icon">ğŸ›¡ï¸</span><span class="s-label">Vulnerabilities</span>
      <span class="sidebar-badge">{{ vulns|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-subdomains" onclick="scrollTo('sec-subdomains')">
      <span class="s-icon">ğŸŒ</span><span class="s-label">Subdomains</span>
      <span class="sidebar-badge">{{ subdomains|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-emails" onclick="scrollTo('sec-emails')">
      <span class="s-icon">ğŸ“§</span><span class="s-label">Emails</span>
      <span class="sidebar-badge">{{ emails|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-takeover" onclick="scrollTo('sec-takeover')">
      <span class="s-icon">ğŸ¯</span><span class="s-label">Takeover</span>
      <span class="sidebar-badge">{{ takeover_records|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-breaches" onclick="scrollTo('sec-breaches')">
      <span class="s-icon">ğŸ”“</span><span class="s-label">Breaches</span>
      <span class="sidebar-badge">{{ breach_records|length }}</span>
    </a>
    <div class="sidebar-divider"></div>
    <a class="sidebar-link" href="#sec-dns" onclick="scrollTo('sec-dns')">
      <span class="s-icon">ğŸ”</span><span class="s-label">DNS Records</span>
      <span class="sidebar-badge">{{ dns_records|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-ssl" onclick="scrollTo('sec-ssl')">
      <span class="s-icon">ğŸ”’</span><span class="s-label">SSL / TLS</span>
      <span class="sidebar-badge">{{ ssl_info|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-ip" onclick="scrollTo('sec-ip')">
      <span class="s-icon">ğŸŒ</span><span class="s-label">IP Intel</span>
      <span class="sidebar-badge">{{ ip_records|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-tech" onclick="scrollTo('sec-tech')">
      <span class="s-icon">âš™ï¸</span><span class="s-label">Technologies</span>
      <span class="sidebar-badge">{{ technologies|length }}</span>
    </a>
    <div class="sidebar-divider"></div>
    <a class="sidebar-link" href="#sec-headers" onclick="scrollTo('sec-headers')">
      <span class="s-icon">ğŸ›¡</span><span class="s-label">Sec Headers</span>
      <span class="sidebar-badge">{{ sec_headers.get('grade','?') }}</span>
    </a>
    <a class="sidebar-link" href="#sec-whois" onclick="scrollTo('sec-whois')">
      <span class="s-icon">ğŸ“‹</span><span class="s-label">WHOIS</span>
      <span class="sidebar-badge">{{ 'âœ“' if whois else 'â€”' }}</span>
    </a>
    <a class="sidebar-link" href="#sec-cloud" onclick="scrollTo('sec-cloud')">
      <span class="s-icon">â˜ï¸</span><span class="s-label">Cloud Assets</span>
      <span class="sidebar-badge">{{ cloud_assets|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-social" onclick="scrollTo('sec-social')">
      <span class="s-icon">ğŸ‘¥</span><span class="s-label">Social</span>
      <span class="sidebar-badge">{{ social.get('profiles', {})|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-typosquats" onclick="scrollTo('sec-typosquats')">
      <span class="s-icon">ğŸ” </span><span class="s-label">Typosquats</span>
      <span class="sidebar-badge">{{ typosquats|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-asn" onclick="scrollTo('sec-asn')">
      <span class="s-icon">ğŸ“¡</span><span class="s-label">ASN Intel</span>
      <span class="sidebar-badge">{{ asn|length }}</span>
    </a>
    <a class="sidebar-link" href="#sec-wayback" onclick="scrollTo('sec-wayback')">
      <span class="s-icon">ğŸ“š</span><span class="s-label">Web Archive</span>
      <span class="sidebar-badge">{{ wayback.get('interesting', [])|length }}</span>
    </a>
  </aside>

  <!-- â•â•â• MAIN CONTENT â•â•â• -->
  <main class="results-main" id="results-main-content">

    <!-- Summary Bar -->
    <div class="summary-bar">
      <div class="summary-top">
        <div>
          <div class="summary-domain">{{ r.domain }}</div>
          <div style="font-size:11px;color:var(--text3);margin-top:2px;font-family:var(--mono)">
            Scan ID: {{ r.scan_id }} &nbsp;Â·&nbsp; {{ r.scan_date[:10] if r.scan_date else '' }}
            &nbsp;Â·&nbsp; Mode: {{ r.mode | upper }}
            &nbsp;Â·&nbsp; Duration: {{ r.duration_seconds }}s
          </div>
        </div>
        <span class="risk-badge risk-{{ scores.get('risk_level','LOW') }}">
          {{ scores.get('risk_level','LOW') }} RISK
        </span>
        <div class="summary-actions">
          <button class="btn btn-ghost btn-sm" onclick="expandAll()">Expand All</button>
          <button class="btn btn-ghost btn-sm" onclick="collapseAll()">Collapse All</button>
          <div class="dropdown">
            <button class="btn btn-ghost btn-sm" onclick="toggleDropdown('dl-menu')">
              â†“ Download â–¾
            </button>
            <div class="dropdown-menu" id="dl-menu">
              <a class="dropdown-item" href="/api/download/{{ r.scan_id }}/json">ğŸ“„ JSON Report</a>
              <a class="dropdown-item" href="/api/download/{{ r.scan_id }}/txt">ğŸ“ TXT Report</a>
              <a class="dropdown-item" href="/api/download/{{ r.scan_id }}/html">ğŸŒ HTML Report</a>
            </div>
          </div>
          <a href="/" class="btn btn-primary btn-sm">+ New Scan</a>
        </div>
      </div>

      <!-- Score Cards -->
      <div class="score-grid">
        {% set atk    = scores.get('attack_surface', 0)  | int %}
        {% set tech_s = scores.get('technology_risk', 0) | int %}
        {% set exp_s  = scores.get('exposure', 0)        | int %}
        {% set vuln_s = scores.get('vulnerability', 0)   | int %}
        {% set overall = scores.get('overall', 0)        | int %}

        <div class="score-card">
          <div class="score-card-label">Attack Surface</div>
          <div class="score-card-value" style="color:{% if atk >= 75 %}var(--red){% elif atk >= 50 %}var(--orange){% elif atk >= 25 %}var(--yellow){% else %}var(--green){% endif %}">{{ atk }}</div>
          <div class="score-bar-wrap"><div class="score-bar-fill" style="width:{{ atk }}%;background:{% if atk >= 75 %}var(--red){% elif atk >= 50 %}var(--orange){% elif atk >= 25 %}var(--yellow){% else %}var(--green){% endif %}"></div></div>
        </div>
        <div class="score-card">
          <div class="score-card-label">Tech Risk</div>
          <div class="score-card-value" style="color:{% if tech_s >= 75 %}var(--red){% elif tech_s >= 50 %}var(--orange){% elif tech_s >= 25 %}var(--yellow){% else %}var(--green){% endif %}">{{ tech_s }}</div>
          <div class="score-bar-wrap"><div class="score-bar-fill" style="width:{{ tech_s }}%;background:{% if tech_s >= 75 %}var(--red){% elif tech_s >= 50 %}var(--orange){% elif tech_s >= 25 %}var(--yellow){% else %}var(--green){% endif %}"></div></div>
        </div>
        <div class="score-card">
          <div class="score-card-label">Exposure</div>
          <div class="score-card-value" style="color:{% if exp_s >= 75 %}var(--red){% elif exp_s >= 50 %}var(--orange){% elif exp_s >= 25 %}var(--yellow){% else %}var(--green){% endif %}">{{ exp_s }}</div>
          <div class="score-bar-wrap"><div class="score-bar-fill" style="width:{{ exp_s }}%;background:{% if exp_s >= 75 %}var(--red){% elif exp_s >= 50 %}var(--orange){% elif exp_s >= 25 %}var(--yellow){% else %}var(--green){% endif %}"></div></div>
        </div>
        <div class="score-card">
          <div class="score-card-label">Vuln Score</div>
          <div class="score-card-value" style="color:{% if vuln_s >= 75 %}var(--red){% elif vuln_s >= 50 %}var(--orange){% elif vuln_s >= 25 %}var(--yellow){% else %}var(--green){% endif %}">{{ vuln_s }}</div>
          <div class="score-bar-wrap"><div class="score-bar-fill" style="width:{{ vuln_s }}%;background:{% if vuln_s >= 75 %}var(--red){% elif vuln_s >= 50 %}var(--orange){% elif vuln_s >= 25 %}var(--yellow){% else %}var(--green){% endif %}"></div></div>
        </div>
        <div class="score-card" style="background:var(--bg);border:2px solid var(--border)">
          <div class="score-card-label">Overall Risk</div>
          <div style="display:flex;flex-direction:column;align-items:center;gap:6px;padding:4px 0">
            <canvas id="risk-gauge" width="80" height="50"></canvas>
            <div class="risk-badge risk-{{ scores.get('risk_level','LOW') }}" style="font-size:13px;padding:4px 14px">
              {{ overall }}
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="quick-stats" style="margin-top:14px;margin-bottom:0">
        <div class="stat-chip"><span class="chip-icon">ğŸŒ</span><strong>{{ subdomains|length }}</strong> subdomains</div>
        <div class="stat-chip"><span class="chip-icon">ğŸ“§</span><strong>{{ emails|length }}</strong> emails</div>
        <div class="stat-chip"><span class="chip-icon">ğŸ›¡ï¸</span><strong>{{ vulns|length }}</strong> vulns</div>
        <div class="stat-chip"><span class="chip-icon">ğŸ¯</span><strong>{{ takeover_records|length }}</strong> takeover</div>
        <div class="stat-chip"><span class="chip-icon">ğŸ”“</span><strong>{{ breach_records|length }}</strong> breaches</div>
        <div class="stat-chip"><span class="chip-icon">âš™ï¸</span><strong>{{ technologies|length }}</strong> tech</div>
        <div class="stat-chip"><span class="chip-icon">â˜ï¸</span><strong>{{ cloud_assets|length }}</strong> cloud</div>
        {% if ns.crit > 0 %}<div class="stat-chip"><span style="color:var(--red)">ğŸš¨</span><strong style="color:var(--red)">{{ ns.crit }}</strong> critical vulns</div>{% endif %}
      </div>
    </div>

    <!-- â”€â”€â”€ EXPAND/COLLAPSE ALL â”€â”€â”€ -->
    <div class="expand-all-bar">
      <button class="btn btn-ghost btn-sm" onclick="expandAll()">âŠ Expand All</button>
      <button class="btn btn-ghost btn-sm" onclick="collapseAll()">âŠŸ Collapse All</button>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• VULNERABILITY SECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-vulnerabilities">
      <div class="section-header open" onclick="toggleSection('vulnerabilities')">
        <span class="section-title">ğŸ›¡ï¸ Vulnerabilities</span>
        <span class="section-count">{{ vulns|length }}</span>
        {% if ns.crit > 0 %}<span class="sev sev-CRITICAL" style="margin-left:4px">{{ ns.crit }} CRITICAL</span>{% endif %}
        {% if ns.high > 0 %}<span class="sev sev-HIGH" style="margin-left:2px">{{ ns.high }} HIGH</span>{% endif %}
        <svg class="section-chevron" id="chev-vulnerabilities" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-vulnerabilities" data-default="open">
        <div class="section-inner">
          {% if vulns %}
          <div class="vuln-filter-bar">
            <button class="vfilt active" data-filter="all" onclick="filterVulns(this,'all')">
              All <span class="vfilt-count">{{ vulns|length }}</span>
            </button>
            <button class="vfilt crit" data-filter="CRITICAL" onclick="filterVulns(this,'CRITICAL')">
              Critical <span class="vfilt-count" style="background:rgba(239,68,68,.2);color:var(--red)">{{ ns.crit }}</span>
            </button>
            <button class="vfilt high" data-filter="HIGH" onclick="filterVulns(this,'HIGH')">
              High <span class="vfilt-count" style="background:rgba(249,115,22,.2);color:var(--orange)">{{ ns.high }}</span>
            </button>
            <button class="vfilt med" data-filter="MEDIUM" onclick="filterVulns(this,'MEDIUM')">
              Medium <span class="vfilt-count" style="background:rgba(245,158,11,.2);color:var(--yellow)">{{ ns.med }}</span>
            </button>
            <button class="vfilt low" data-filter="LOW" onclick="filterVulns(this,'LOW')">
              Low <span class="vfilt-count">{{ ns.low }}</span>
            </button>
          </div>
          <div id="vuln-list">
            {% for v in vulns %}
            <div class="vuln-card" data-sev="{{ v.severity | default('INFO') }}">
              <div class="vuln-header">
                <span class="sev sev-{{ v.severity | default('INFO') }}">{{ v.severity | default('INFO') }}</span>
                <div class="vuln-title">{{ v.title | default('') }}</div>
                <span class="vuln-source">{{ v.source | default('') }}</span>
              </div>
              <div class="vuln-body">
                <div class="vuln-meta">
                  {% if v.cve_id %}<span>
                    {% if v.cve_id.startswith('CVE-') %}
                      <strong>CVE:</strong> <a href="https://nvd.nist.gov/vuln/detail/{{ v.cve_id }}" target="_blank" style="font-family:var(--mono);font-size:11px">{{ v.cve_id }}</a>
                    {% else %}
                      <strong>ID:</strong> <code>{{ v.cve_id }}</code>
                    {% endif %}
                  </span>{% endif %}
                  {% if v.cvss_score %}<span><strong>CVSS:</strong> <code style="color:{% if v.cvss_score | float >= 9.0 %}var(--red){% elif v.cvss_score | float >= 7.0 %}var(--orange){% elif v.cvss_score | float >= 4.0 %}var(--yellow){% else %}var(--green){% endif %}">{{ v.cvss_score }}</code></span>{% endif %}
                  {% if v.affected_asset %}<span><strong>Asset:</strong> <code>{{ v.affected_asset }}</code></span>{% endif %}
                </div>
                {% if v.description %}<div class="vuln-desc">{{ v.description }}</div>{% endif %}
                {% if v.remediation %}<div class="vuln-remediation">{{ v.remediation }}</div>{% endif %}
                {% if v.references %}
                <div class="vuln-refs">
                  {% for ref in (v.references or [])[:3] %}
                  <a href="{{ ref }}" target="_blank" rel="noopener">{{ ref[:60] }}{% if ref|length > 60 %}â€¦{% endif %}</a>
                  {% endfor %}
                </div>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">âœ…</div>No vulnerabilities detected.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SUBDOMAINS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-subdomains">
      <div class="section-header open" onclick="toggleSection('subdomains')">
        <span class="section-title">ğŸŒ Subdomains</span>
        <span class="section-count">{{ subdomains|length }}</span>
        <svg class="section-chevron" id="chev-subdomains" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-subdomains" data-default="open">
        <div class="section-inner">
          {% if subdomains %}
          <div class="section-toolbar">
            <button class="btn btn-ghost btn-sm" onclick="copyAllSubdomains()">ğŸ“‹ Copy All</button>
            <input type="text" id="sub-filter" class="domain-input" style="max-width:220px;padding:5px 10px;font-size:12px" placeholder="Filter subdomainsâ€¦" oninput="filterTable('sub-table', this.value, 0)">
          </div>
          <div class="table-wrap">
            <table class="data-table" id="sub-table">
              <thead>
                <tr><th>Subdomain</th><th>IP(s)</th><th>Ports</th><th>Takeover</th><th>Wildcard</th><th>Sources</th></tr>
              </thead>
              <tbody>
                {% for s in subdomains %}
                <tr>
                  <td class="mono" style="color:var(--cyan)">{{ s.name | default('') }}</td>
                  <td class="mono" style="color:var(--text2);font-size:11px">{{ (s.ips or []) | join(', ') or 'â€”' }}</td>
                  <td>
                    {% for p in (s.ports or []) %}{% set pi = p | int %}
                    <span class="port-b {% if pi in [443, 8443] %}port-https{% elif pi in [80, 8080] %}port-http{% elif pi == 22 %}port-ssh{% elif pi in [21, 23, 25, 445, 3306, 5432, 6379, 9200, 27017, 2375, 11211] %}port-danger{% else %}port-other{% endif %}">{{ pi }}</span>
                    {% else %}<span style="color:var(--text3)">â€”</span>{% endfor %}
                  </td>
                  <td>
                    {% set ts = s.takeover_status | default('UNKNOWN') %}
                    {% if ts == 'VULNERABLE' %}<span class="badge badge-red">VULN</span>
                    {% elif ts == 'POTENTIAL' %}<span class="badge badge-yellow">POTENTIAL</span>
                    {% elif ts == 'SAFE' %}<span class="badge badge-green">SAFE</span>
                    {% else %}<span style="color:var(--text3)">â€”</span>{% endif %}
                  </td>
                  <td style="text-align:center">
                    {% if s.wildcard_candidate %}<span class="badge badge-yellow">â˜…</span>{% else %}<span style="color:var(--text3)">â€”</span>{% endif %}
                  </td>
                  <td><span class="badge badge-gray">{{ (s.sources or []) | join(', ') or 'â€”' }}</span></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸŒ</div>No subdomains found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EMAILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-emails">
      <div class="section-header open" onclick="toggleSection('emails')">
        <span class="section-title">ğŸ“§ Emails</span>
        <span class="section-count">{{ emails|length }}</span>
        <svg class="section-chevron" id="chev-emails" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-emails" data-default="open">
        <div class="section-inner">
          {% if emails %}
          <div class="section-toolbar">
            <button class="btn btn-ghost btn-sm" onclick="copyAllEmails()">ğŸ“‹ Copy All</button>
            <input type="text" class="domain-input" style="max-width:220px;padding:5px 10px;font-size:12px" placeholder="Filter emailsâ€¦" oninput="filterTable('email-table', this.value, 0)">
          </div>
          <div class="table-wrap">
            <table class="data-table" id="email-table">
              <thead>
                <tr><th>Email</th><th>Name</th><th>Role</th><th>Source</th><th>Confidence</th><th>Breaches</th></tr>
              </thead>
              <tbody>
                {% for e in emails %}
                <tr>
                  <td class="mono" style="color:var(--cyan)">{{ e.email | default('') }}</td>
                  <td style="color:var(--text2)">{{ e.name | default('â€”') }}</td>
                  <td style="color:var(--text2)">{{ e.role | default('â€”') }}</td>
                  <td><span class="badge badge-gray">{{ e.source | default('') }}</span></td>
                  <td><span class="badge {% if e.confidence | default('') == 'high' %}badge-green{% elif e.confidence | default('') == 'medium' %}badge-yellow{% else %}badge-gray{% endif %}">{{ e.confidence | default('medium') }}</span></td>
                  <td>{% if e.breach_count | default(0) | int > 0 %}<span class="badge badge-red">{{ e.breach_count | int }}</span>{% else %}<span style="color:var(--text3)">0</span>{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ“§</div>No emails found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAKEOVER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-takeover">
      <div class="section-header open" onclick="toggleSection('takeover')">
        <span class="section-title">ğŸ¯ Subdomain Takeover</span>
        <span class="section-count">{{ takeover_records|length }}</span>
        <svg class="section-chevron" id="chev-takeover" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-takeover" data-default="open">
        <div class="section-inner">
          {% if takeover_records %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>Subdomain</th><th>Status</th><th>Provider</th><th>CNAME Chain</th><th>Evidence</th></tr>
              </thead>
              <tbody>
                {% for t in takeover_records %}
                <tr>
                  <td class="mono" style="color:var(--cyan)">{{ t.subdomain | default('') }}</td>
                  <td><span class="sev sev-{% if t.status == 'VULNERABLE' %}CRITICAL{% elif t.status == 'LIKELY_VULNERABLE' %}HIGH{% else %}MEDIUM{% endif %}">{{ t.status | default('') }}</span></td>
                  <td><span class="badge badge-orange">{{ t.provider | default('') }}</span></td>
                  <td class="mono" style="font-size:11px;color:var(--text2)">{{ (t.cname_chain or []) | join(' â†’ ') }}</td>
                  <td style="font-size:12px;color:var(--text2)">{{ t.evidence | default('') }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">âœ…</div>No takeover candidates detected.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BREACHES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-breaches">
      <div class="section-header open" onclick="toggleSection('breaches')">
        <span class="section-title">ğŸ”“ Data Breaches</span>
        <span class="section-count">{{ breach_records|length }}</span>
        <svg class="section-chevron" id="chev-breaches" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-breaches" data-default="open">
        <div class="section-inner">
          {% if breach_records %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>Breach Name</th><th>Date</th><th>Records</th><th>Data Types</th><th>Severity</th></tr>
              </thead>
              <tbody>
                {% for b in breach_records %}
                <tr>
                  <td style="font-weight:600;color:var(--text)">{{ b.name | default('') }}</td>
                  <td style="color:var(--text2);font-family:var(--mono);font-size:12px">{{ b.date | default('â€”') }}</td>
                  <td style="font-family:var(--mono);color:var(--orange)">{{ '{:,}'.format(b.count | default(0)) if b.count else 'â€”' }}</td>
                  <td>
                    {% for dt in (b.data_types or [])[:5] %}
                    <span class="badge badge-gray" style="margin:1px">{{ dt }}</span>
                    {% endfor %}
                  </td>
                  <td><span class="sev sev-{{ b.severity | default('MEDIUM') }}">{{ b.severity | default('MEDIUM') }}</span></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">âœ…</div>No breach records found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DNS RECORDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-dns">
      <div class="section-header" onclick="toggleSection('dns')">
        <span class="section-title">ğŸ” DNS Records</span>
        <span class="section-count">{{ dns_records|length }}</span>
        <svg class="section-chevron rotated" id="chev-dns" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-dns" data-default="closed">
        <div class="section-inner">
          {% if dns_records %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>Type</th><th>Value</th><th>TTL</th></tr>
              </thead>
              <tbody>
                {% for rec in dns_records %}
                <tr>
                  <td><span class="badge dns-{{ rec.type | default('TXT') }}">{{ rec.type | default('') }}</span></td>
                  <td class="mono" style="font-size:11.5px;word-break:break-all;max-width:500px">{{ rec.value | default('') }}</td>
                  <td style="color:var(--text3);font-family:var(--mono);font-size:12px">{{ rec.ttl | default('') }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ”</div>No DNS records found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SSL / TLS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-ssl">
      <div class="section-header" onclick="toggleSection('ssl')">
        <span class="section-title">ğŸ”’ SSL / TLS Certificates</span>
        <span class="section-count">{{ ssl_info|length }}</span>
        <svg class="section-chevron rotated" id="chev-ssl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-ssl" data-default="closed">
        <div class="section-inner">
          {% if ssl_info %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>Subject</th><th>Issuer</th><th>Valid From</th><th>Expires</th><th>Status</th><th>SANs</th></tr>
              </thead>
              <tbody>
                {% for cert in ssl_info %}
                <tr>
                  <td class="mono" style="font-size:11.5px;color:var(--text)">{{ cert.subject | default('') }}</td>
                  <td style="font-size:12px;color:var(--text2)">{{ cert.issuer | default('') }}</td>
                  <td style="font-size:11.5px;font-family:var(--mono);color:var(--text2)">{{ cert.valid_from | default('') }}</td>
                  <td style="font-family:var(--mono);font-size:11.5px;color:{% if cert.expired | default(false) %}var(--red){% elif (cert.days_left | default(999) | int) < 30 %}var(--orange){% elif (cert.days_left | default(999) | int) < 90 %}var(--yellow){% else %}var(--green){% endif %}">
                    {{ cert.valid_to | default('') }}
                    {% if (cert.days_left | default(0) | int) > 0 %}<span style="color:var(--text3);font-size:10.5px"> ({{ cert.days_left | int }}d)</span>{% endif %}
                  </td>
                  <td>
                    {% if cert.expired | default(false) %}
                      <span class="badge badge-red">EXPIRED</span>
                    {% elif (cert.days_left | default(999) | int) < 30 %}
                      <span class="badge badge-orange">EXPIRING</span>
                    {% else %}
                      <span class="badge badge-green">VALID</span>
                    {% endif %}
                  </td>
                  <td style="font-size:11px;color:var(--text2)">{{ (cert.san or [])[:3] | join(', ') }}{% if (cert.san or [])|length > 3 %} +{{ (cert.san or [])|length - 3 }}{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ”’</div>No SSL certificates found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• IP INTELLIGENCE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-ip">
      <div class="section-header" onclick="toggleSection('ip')">
        <span class="section-title">ğŸŒ IP Intelligence</span>
        <span class="section-count">{{ ip_records|length }}</span>
        <svg class="section-chevron rotated" id="chev-ip" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-ip" data-default="closed">
        <div class="section-inner">
          {% if ip_records %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>IP</th><th>Country</th><th>ASN / Org</th><th>Open Ports</th><th>CVEs</th><th>Abuse</th><th>Cloud</th></tr>
              </thead>
              <tbody>
                {% for ip in ip_records %}
                <tr>
                  <td>
                    <span class="mono" style="color:var(--cyan)">{{ ip.ip | default('') }}</span>
                    {% if ip.ptr | default('') %}<div style="font-size:10.5px;color:var(--text3);font-family:var(--mono)">{{ ip.ptr }}</div>{% endif %}
                  </td>
                  <td style="color:var(--text2);font-size:12px">{{ ip.country | default('') }} {{ ip.city | default('') }}</td>
                  <td style="font-size:11.5px;color:var(--text2)">
                    {% if ip.asn | default('') %}<div class="mono" style="font-size:11px;color:var(--accent)">{{ ip.asn }}</div>{% endif %}
                    {{ ip.asn_org | default(ip.isp | default('â€”')) }}
                  </td>
                  <td>
                    {% for p in (ip.open_ports or [])[:8] %}{% set pi = p | int %}
                    <span class="port-b {% if pi in [443, 8443] %}port-https{% elif pi in [80, 8080] %}port-http{% elif pi == 22 %}port-ssh{% elif pi in [21, 23, 25, 445, 3306, 5432, 6379, 9200, 27017, 2375, 11211] %}port-danger{% else %}port-other{% endif %}">{{ pi }}</span>
                    {% else %}<span style="color:var(--text3)">â€”</span>{% endfor %}
                    {% if (ip.open_ports or [])|length > 8 %}<span style="color:var(--text3);font-size:10.5px"> +{{ (ip.open_ports or [])|length - 8 }}</span>{% endif %}
                  </td>
                  <td>
                    {% if ip.vulns %}
                    <span class="badge badge-red">{{ (ip.vulns or [])|length }} CVE</span>
                    {% else %}<span style="color:var(--text3)">â€”</span>{% endif %}
                  </td>
                  <td>
                    {% if (ip.abuse_score | default(0) | int) > 50 %}<span class="badge badge-red">{{ ip.abuse_score | int }}</span>
                    {% elif (ip.abuse_score | default(0) | int) > 20 %}<span class="badge badge-orange">{{ ip.abuse_score | int }}</span>
                    {% elif (ip.abuse_score | default(0) | int) > 0 %}<span class="badge badge-yellow">{{ ip.abuse_score | int }}</span>
                    {% else %}<span style="color:var(--text3)">0</span>{% endif %}
                  </td>
                  <td style="color:var(--text2);font-size:12px">{{ ip.cloud_provider | default('â€”') }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸŒ</div>No IP records found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TECHNOLOGIES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-tech">
      <div class="section-header" onclick="toggleSection('tech')">
        <span class="section-title">âš™ï¸ Technologies</span>
        <span class="section-count">{{ technologies|length }}</span>
        <svg class="section-chevron rotated" id="chev-tech" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-tech" data-default="closed">
        <div class="section-inner">
          {% if technologies %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>Name</th><th>Category</th><th>Version</th><th>Confidence</th></tr>
              </thead>
              <tbody>
                {% for t in technologies %}
                <tr>
                  <td style="font-weight:600;color:var(--text)">{{ t.name | default('') }}</td>
                  <td><span class="badge badge-purple">{{ t.category | default('') }}</span></td>
                  <td class="mono" style="color:var(--text2)">{{ t.version | default('â€”') }}</td>
                  <td>
                    {% set conf = t.confidence | default(0) | int %}
                    <div style="display:flex;align-items:center;gap:8px">
                      <div style="width:60px;height:5px;background:var(--border2);border-radius:3px;overflow:hidden">
                        <div style="width:{{ conf }}%;height:100%;background:{% if conf >= 80 %}var(--green){% elif conf >= 50 %}var(--yellow){% else %}var(--text3){% endif %};border-radius:3px"></div>
                      </div>
                      <span style="font-size:11px;color:var(--text2)">{{ conf }}%</span>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">âš™ï¸</div>No technologies detected.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECURITY HEADERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-headers">
      <div class="section-header" onclick="toggleSection('headers')">
        <span class="section-title">ğŸ›¡ Security Headers</span>
        {% if sec_headers.get('grade') %}<span class="badge badge-{% if sec_headers.get('grade','') == 'A' %}green{% elif sec_headers.get('grade','') == 'B' %}yellow{% else %}red{% endif %}">Grade {{ sec_headers.get('grade','?') }}</span>{% endif %}
        <svg class="section-chevron rotated" id="chev-headers" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-headers" data-default="closed">
        <div class="section-inner">
          {% if sec_headers %}
          <div style="display:flex;align-items:flex-start;gap:24px;flex-wrap:wrap;margin-bottom:16px">
            <div>
              <div class="grade-display grade-{{ sec_headers.get('grade', 'F') }}">{{ sec_headers.get('grade','?') }}</div>
              <div style="font-size:11px;color:var(--text3);text-align:center;margin-top:4px">Score: {{ sec_headers.get('score', 0) }}/100</div>
            </div>
            <div style="flex:1;min-width:200px">
              {% for hdr in sec_headers.get('headers_present', []) %}
              <div class="header-check">
                <span class="check-ok">âœ“</span>
                <span class="check-name">{{ hdr }}</span>
                <span class="check-val">{{ sec_headers.get('details', {}).get(hdr, '') }}</span>
              </div>
              {% endfor %}
              {% for hdr in sec_headers.get('headers_missing', []) %}
              <div class="header-check">
                <span class="check-miss">âœ—</span>
                <span class="check-name" style="color:var(--red)">{{ hdr }}</span>
                <span class="check-val" style="color:var(--text3)">Missing</span>
              </div>
              {% endfor %}
            </div>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ›¡</div>No security header data.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WHOIS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-whois">
      <div class="section-header" onclick="toggleSection('whois')">
        <span class="section-title">ğŸ“‹ WHOIS</span>
        <svg class="section-chevron rotated" id="chev-whois" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-whois" data-default="closed">
        <div class="section-inner">
          {% if whois %}
          <div class="kv-grid">
            {% if whois.get('registrar') %}<div class="kv-row"><div class="kv-key">Registrar</div><div class="kv-val">{{ whois.registrar }}</div></div>{% endif %}
            {% if whois.get('creation_date') %}<div class="kv-row"><div class="kv-key">Created</div><div class="kv-val">{{ whois.creation_date }}</div></div>{% endif %}
            {% if whois.get('expiration_date') %}<div class="kv-row"><div class="kv-key">Expires</div><div class="kv-val">{{ whois.expiration_date }}</div></div>{% endif %}
            {% if whois.get('updated_date') %}<div class="kv-row"><div class="kv-key">Updated</div><div class="kv-val">{{ whois.updated_date }}</div></div>{% endif %}
            {% if whois.get('name_servers') %}<div class="kv-row"><div class="kv-key">Name Servers</div><div class="kv-val">{{ whois.name_servers | join(', ') if whois.name_servers is iterable else whois.name_servers }}</div></div>{% endif %}
            {% if whois.get('status') %}<div class="kv-row"><div class="kv-key">Status</div><div class="kv-val">{{ whois.status }}</div></div>{% endif %}
            {% for key in ['org', 'country', 'emails'] %}
              {% if whois.get(key) %}<div class="kv-row"><div class="kv-key">{{ key | capitalize }}</div><div class="kv-val">{{ whois[key] }}</div></div>{% endif %}
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ“‹</div>No WHOIS data available.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CLOUD ASSETS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-cloud">
      <div class="section-header" onclick="toggleSection('cloud')">
        <span class="section-title">â˜ï¸ Cloud Assets</span>
        <span class="section-count">{{ cloud_assets|length }}</span>
        <svg class="section-chevron rotated" id="chev-cloud" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-cloud" data-default="closed">
        <div class="section-inner">
          {% if cloud_assets %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>Asset</th><th>Provider</th><th>Type</th><th>Region</th><th>Public</th></tr>
              </thead>
              <tbody>
                {% for c in cloud_assets %}
                <tr>
                  <td class="mono" style="font-size:12px;color:var(--cyan)">
                    {% if c.url | default('') %}<a href="{{ c.url }}" target="_blank">{{ c.asset | default('') }}</a>{% else %}{{ c.asset | default('') }}{% endif %}
                  </td>
                  <td><span class="badge badge-cyan">{{ c.provider | default('') }}</span></td>
                  <td style="color:var(--text2)">{{ c.asset_type | default('') }}</td>
                  <td style="color:var(--text2);font-size:12px">{{ c.region | default('â€”') }}</td>
                  <td>{% if c.public | default(false) %}<span class="badge badge-red">Public</span>{% else %}<span class="badge badge-green">Private</span>{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">â˜ï¸</div>No cloud assets found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SOCIAL FOOTPRINT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-social">
      <div class="section-header" onclick="toggleSection('social')">
        <span class="section-title">ğŸ‘¥ Social Footprint</span>
        <span class="section-count">{{ social.get('profiles', {})|length }}</span>
        <svg class="section-chevron rotated" id="chev-social" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-social" data-default="closed">
        <div class="section-inner">
          {% set profiles = social.get('profiles', {}) %}
          {% if profiles %}
          <div class="info-grid">
            {% for platform, url in profiles.items() %}
            <div class="info-chip">
              <div class="info-chip-label">{{ platform | capitalize }}</div>
              <div class="info-chip-val" style="font-size:12px">
                {% if url %}<a href="{{ url }}" target="_blank" rel="noopener">{{ url[:50] }}{% if url|length > 50 %}â€¦{% endif %}</a>{% else %}â€”{% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ‘¥</div>No social profiles found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TYPOSQUATS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-typosquats">
      <div class="section-header" onclick="toggleSection('typosquats')">
        <span class="section-title">ğŸ”  Typosquats</span>
        <span class="section-count">{{ typosquats|length }}</span>
        <svg class="section-chevron rotated" id="chev-typosquats" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-typosquats" data-default="closed">
        <div class="section-inner">
          {% if typosquats %}
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr><th>Domain</th><th>Type</th><th>IP</th><th>Registered</th><th>MX</th></tr>
              </thead>
              <tbody>
                {% for t in typosquats %}
                {% set td = t if t is mapping else {} %}
                <tr>
                  <td class="mono" style="color:var(--orange)">{{ td.get('domain', t if t is string else '') }}</td>
                  <td><span class="badge badge-yellow">{{ td.get('fuzzer', td.get('type','â€”')) }}</span></td>
                  <td class="mono" style="font-size:11.5px;color:var(--text2)">{{ td.get('ip','â€”') }}</td>
                  <td>{% if td.get('registered') or td.get('ip') %}<span class="badge badge-red">Yes</span>{% else %}<span class="badge badge-green">No</span>{% endif %}</td>
                  <td>{% if td.get('mx') %}<span class="badge badge-orange">Yes</span>{% else %}<span style="color:var(--text3)">â€”</span>{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ” </div>No typosquat domains detected.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ASN INTELLIGENCE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-asn">
      <div class="section-header" onclick="toggleSection('asn')">
        <span class="section-title">ğŸ“¡ ASN Intelligence</span>
        <svg class="section-chevron rotated" id="chev-asn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-asn" data-default="closed">
        <div class="section-inner">
          {% if asn %}
          <div class="info-grid">
            {% for key, val in asn.items() %}
            {% if val %}
            <div class="info-chip">
              <div class="info-chip-label">{{ key | replace('_',' ') | capitalize }}</div>
              <div class="info-chip-val" style="font-size:12px">
                {% if val is iterable and val is not string %}{{ val | join(', ') | truncate(80) }}{% else %}{{ val | string | truncate(80) }}{% endif %}
              </div>
            </div>
            {% endif %}
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ“¡</div>No ASN data available.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WEB ARCHIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="section-card" id="sec-wayback">
      <div class="section-header" onclick="toggleSection('wayback')">
        <span class="section-title">ğŸ“š Web Archive</span>
        <span class="section-count">{{ wayback.get('interesting', [])|length }}</span>
        <svg class="section-chevron rotated" id="chev-wayback" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="section-body" id="sbody-wayback" data-default="closed">
        <div class="section-inner">
          {% set interesting = wayback.get('interesting', []) %}
          {% if interesting %}
          <div style="margin-bottom:8px;font-size:12px;color:var(--text2)">
            Interesting archived URLs ({{ interesting|length }} found):
          </div>
          <div style="display:flex;flex-direction:column;gap:4px;max-height:320px;overflow-y:auto">
            {% for url in interesting[:100] %}
            <div style="display:flex;align-items:center;gap:8px;padding:5px 8px;border-radius:var(--r1);background:var(--bg)">
              <span style="font-size:11px;font-family:var(--mono);color:var(--text2);word-break:break-all;flex:1">{{ url }}</span>
              <a href="{{ url }}" target="_blank" rel="noopener" style="font-size:10px;color:var(--accent);flex-shrink:0">â†—</a>
            </div>
            {% endfor %}
          </div>
          {% elif wayback.get('total', 0) %}
          <div class="empty-state"><div class="ei">ğŸ“š</div>{{ wayback.get('total', 0) }} total URLs found â€” no interesting patterns detected.</div>
          {% else %}
          <div class="empty-state"><div class="ei">ğŸ“š</div>No archived URLs found.</div>
          {% endif %}
        </div>
      </div>
    </div>

  </main>
</div>
{% endif %}{# end results/results_fragment #}

{% if page != "results_fragment" %}

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer class="footer">
  Ghost Recon Tool &nbsp;&middot;&nbsp; Passive OSINT Platform &nbsp;&middot;&nbsp; created by <strong>mnt0x</strong>
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST NOTIFICATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let selectedMode = 'balanced';
let activeEventSource = null;
let activeScanId = null;

/* â”€â”€â”€ Mode selection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function selectMode(el) {
  document.querySelectorAll('.mode-pill').forEach(p => p.classList.remove('selected'));
  el.classList.add('selected');
  selectedMode = el.dataset.mode;
}

/* â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showToast(msg, duration=2200) {
  const t = document.getElementById('toast');
  if (!t) return;
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(t._timer);
  t._timer = setTimeout(() => t.classList.remove('show'), duration);
}

/* â”€â”€â”€ Copy helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function copyText(text) {
  navigator.clipboard.writeText(text).then(() => showToast('Copied!')).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showToast('Copied!');
  });
}

function copyAllSubdomains() {
  const rows = document.querySelectorAll('#sub-table tbody tr');
  const subs = Array.from(rows).map(r => r.cells[0]?.textContent?.trim()).filter(Boolean);
  copyText(subs.join('\n'));
}

function copyAllEmails() {
  const rows = document.querySelectorAll('#email-table tbody tr');
  const emails = Array.from(rows).map(r => r.cells[0]?.textContent?.trim()).filter(Boolean);
  copyText(emails.join('\n'));
}

/* â”€â”€â”€ Dropdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleDropdown(id) {
  const m = document.getElementById(id);
  if (!m) return;
  m.classList.toggle('open');
}
document.addEventListener('click', function(e) {
  if (!e.target.closest('.dropdown')) {
    document.querySelectorAll('.dropdown-menu.open').forEach(m => m.classList.remove('open'));
  }
});

/* â”€â”€â”€ Scroll to section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function scrollTo(id) {
  const el = document.getElementById(id);
  if (!el) return;
  const top = el.getBoundingClientRect().top + window.scrollY - 64;
  window.scrollTo({ top, behavior: 'smooth' });
}

/* â”€â”€â”€ Table filter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function filterTable(tableId, query, colIdx) {
  const tbl = document.getElementById(tableId);
  if (!tbl) return;
  const q = query.toLowerCase();
  tbl.querySelectorAll('tbody tr').forEach(row => {
    const cell = row.cells[colIdx];
    const text = cell ? cell.textContent.toLowerCase() : '';
    row.style.display = text.includes(q) ? '' : 'none';
  });
}

/* â”€â”€â”€ Vulnerability filter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function filterVulns(btn, sev) {
  document.querySelectorAll('.vfilt').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('#vuln-list .vuln-card').forEach(card => {
    card.classList.toggle('hidden', sev !== 'all' && card.dataset.sev !== sev);
  });
}

/* â”€â”€â”€ Collapsible sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleSection(id) {
  const body = document.getElementById('sbody-' + id);
  const chev = document.getElementById('chev-' + id);
  const hdr  = body?.previousElementSibling;
  if (!body) return;
  const collapsed = body.dataset.collapsed === 'true';
  if (collapsed) {
    body.dataset.collapsed = 'false';
    body.style.transition = 'max-height 0.35s ease';
    body.style.maxHeight = body.scrollHeight + 'px';
    body.addEventListener('transitionend', () => {
      if (body.dataset.collapsed === 'false') body.style.maxHeight = 'none';
    }, { once: true });
    if (chev) chev.classList.remove('rotated');
    if (hdr)  hdr.classList.add('open');
  } else {
    body.dataset.collapsed = 'true';
    body.style.maxHeight = body.scrollHeight + 'px';
    requestAnimationFrame(() => {
      body.style.transition = 'max-height 0.3s ease';
      body.style.maxHeight = '0px';
    });
    if (chev) chev.classList.add('rotated');
    if (hdr)  hdr.classList.remove('open');
  }
}

function expandAll() {
  document.querySelectorAll('.section-body').forEach(body => {
    const id = body.id.replace('sbody-', '');
    if (body.dataset.collapsed === 'true') toggleSection(id);
  });
}

function collapseAll() {
  document.querySelectorAll('.section-body').forEach(body => {
    const id = body.id.replace('sbody-', '');
    if (body.dataset.collapsed !== 'true') toggleSection(id);
  });
}

/* â”€â”€â”€ Init sections (set initial collapsed state) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initSectionStates() {
  document.querySelectorAll('.section-body').forEach(body => {
    const def = body.dataset.default || 'open';
    if (def === 'closed') {
      body.dataset.collapsed = 'true';
      body.style.maxHeight = '0px';
    } else {
      body.dataset.collapsed = 'false';
      body.style.maxHeight = 'none';
    }
  });
}

/* â”€â”€â”€ Sidebar scroll spy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initScrollSpy() {
  const sections = document.querySelectorAll('.section-card[id]');
  const links = document.querySelectorAll('.sidebar-link');
  if (!sections.length || !links.length) return;

  const obs = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        links.forEach(l => l.classList.remove('active'));
        const id = entry.target.id;
        const link = document.querySelector(`.sidebar-link[href="#${id}"]`);
        if (link) link.classList.add('active');
      }
    });
  }, { rootMargin: '-5% 0px -80% 0px', threshold: 0 });

  sections.forEach(s => obs.observe(s));
}

/* â”€â”€â”€ Risk gauge chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initRiskGauge() {
  const canvas = document.getElementById('risk-gauge');
  if (!canvas || typeof Chart === 'undefined') return;
  const score = parseInt(canvas.closest('.score-card')?.querySelector('.risk-badge')?.textContent?.trim() || 0);
  const level = canvas.closest('.results-main')?.querySelector('.risk-badge')?.textContent?.trim().split(' ')[0] || 'LOW';
  const colors = { CRITICAL: '#ef4444', HIGH: '#f97316', MEDIUM: '#f59e0b', LOW: '#10b981' };
  const color = colors[level] || '#3b82f6';
  new Chart(canvas, {
    type: 'doughnut',
    data: {
      datasets: [{ data: [score, 100 - score], backgroundColor: [color, '#1e2d4a'], borderWidth: 0, circumference: 180, rotation: -90 }]
    },
    options: {
      cutout: '72%',
      plugins: { legend: { display: false }, tooltip: { enabled: false } },
      animation: { animateRotate: true, duration: 900 }
    }
  });
}

/* â”€â”€â”€ initResultsUI â€” called after DOM has results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function initResultsUI() {
  initSectionStates();
  initScrollSpy();
  initRiskGauge();
}

/* â”€â”€â”€ Scan overlay helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showOverlay(domain) {
  const o = document.getElementById('scan-overlay');
  const od = document.getElementById('overlay-domain');
  const pl = document.getElementById('phase-list');
  const os = document.getElementById('overlay-status');
  if (!o) return;
  if (od) od.textContent = domain;
  if (pl) pl.innerHTML = '';
  if (os) os.innerHTML = '<span class="spinner"></span> Initializing modulesâ€¦';
  o.classList.add('visible');
  document.getElementById('home-view')?.style && (document.getElementById('home-view').style.display = 'none');
  const nav = document.getElementById('nav-scan-status');
  if (nav) nav.style.display = 'flex';
  document.getElementById('nav-status-text') && (document.getElementById('nav-status-text').textContent = 'Scanning ' + domain);
}

function hideOverlay() {
  const o = document.getElementById('scan-overlay');
  if (o) o.classList.remove('visible');
  const nav = document.getElementById('nav-scan-status');
  if (nav) nav.style.display = 'none';
}

function updatePhase(name, status, count) {
  const sid = 'phase-' + name.replace(/[^a-z0-9]/gi, '-');
  let row = document.getElementById(sid);
  if (!row) {
    row = document.createElement('div');
    row.id = sid;
    row.className = 'phase-row';
    row.innerHTML = '<span class="phase-icon">â³</span><span class="phase-name"></span><span class="phase-cnt"></span>';
    document.getElementById('phase-list')?.appendChild(row);
  }
  row.querySelector('.phase-icon').textContent =
    status === 'done' ? 'âœ…' : status === 'running' ? 'âš¡' : 'âŒ';
  row.querySelector('.phase-name').textContent = name;
  if (count !== undefined && count !== null)
    row.querySelector('.phase-cnt').textContent = count > 0 ? `+${count}` : '';
}

/* â”€â”€â”€ Start scan â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startScan() {
  const input = document.getElementById('domain-input');
  if (!input) return;
  let domain = input.value.trim().toLowerCase().replace(/^https?:\/\//,'').split('/')[0];
  if (!domain) { showToast('Enter a domain first.'); input.focus(); return; }
  if (!/^(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/.test(domain)) {
    showToast('Invalid domain format.'); input.focus(); return;
  }

  if (activeEventSource) { activeEventSource.close(); activeEventSource = null; }

  showOverlay(domain);

  const es = new EventSource(`/scan/stream?domain=${encodeURIComponent(domain)}&mode=${selectedMode}`);
  activeEventSource = es;

  es.addEventListener('start', e => {
    const d = JSON.parse(e.data);
    activeScanId = d.scan_id;
    document.getElementById('overlay-status').innerHTML = '<span class="spinner"></span> Running intelligence modulesâ€¦';
  });

  es.addEventListener('phase', e => {
    const d = JSON.parse(e.data);
    updatePhase(d.name, d.status, d.count);
  });

  es.addEventListener('complete', e => {
    const d = JSON.parse(e.data);
    activeScanId = d.scan_id;
    document.getElementById('overlay-status').innerHTML = '<span class="spinner"></span> Building resultsâ€¦';
  });

  es.addEventListener('saved', e => {
    es.close(); activeEventSource = null;
    const d = JSON.parse(e.data);
    const sid = d.scan_id;
    document.getElementById('overlay-status').innerHTML = '<span class="spinner"></span> Loading resultsâ€¦';
    fetch(`/api/result-fragment/${sid}`)
      .then(r => { if (!r.ok) throw new Error(r.status); return r.text(); })
      .then(html => {
        hideOverlay();
        const mount = document.getElementById('results-mount');
        if (!mount) return;
        mount.innerHTML = html;
        mount.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
        initResultsUI();
        // Add "New Scan" nav link
        const nav = document.getElementById('nav-scan-status');
        if (nav) nav.style.display = 'none';
      })
      .catch(err => {
        hideOverlay();
        document.getElementById('home-view') && (document.getElementById('home-view').style.display = '');
        showToast('Error loading results. Try viewing from History.', 5000);
      });
  });

  es.addEventListener('error', e => {
    try {
      const d = JSON.parse(e.data || '{}');
      showToast('Scan error: ' + (d.message || 'Unknown error'), 5000);
    } catch {}
    es.close(); activeEventSource = null;
    hideOverlay();
    document.getElementById('home-view') && (document.getElementById('home-view').style.display = '');
  });

  es.onerror = () => {
    if (es.readyState === EventSource.CLOSED) return;
    showToast('Connection lost. Check scan history.', 4000);
    es.close(); activeEventSource = null;
    hideOverlay();
  };
}

/* â”€â”€â”€ Key bindings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('keydown', e => {
  if (e.key === 'Enter' && document.activeElement?.id === 'domain-input') startScan();
  if (e.key === 'Escape' && activeEventSource) {
    activeEventSource.close(); activeEventSource = null;
    hideOverlay();
    document.getElementById('home-view') && (document.getElementById('home-view').style.display = '');
  }
});

/* â”€â”€â”€ Bootstrap on DOMContentLoaded â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('DOMContentLoaded', () => {
  if (document.getElementById('results-layout')) {
    initResultsUI();
  }
});
</script>
</body>
</html>
{% endif %}{# end !results_fragment #}
